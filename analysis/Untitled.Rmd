---
title: "Module 3: Correlation"
author: "Stefano Cacciatore"
output: 
  html_document:
  toc: true
  toc_depth: 2
  theme: lumen
date: "`r format(Sys.Date(), '%B %d, %Y')`"
---

## **5. Correlation:**

Correlation analysis is used to investigate the association between two or more variables.

### Step 1: Choose a Correlation Method

***Pearson Correlation*** measures the linear relationship between two continuous variables. It assumes both variables follow a normal distribution.

***Spearman and Kendall Correlation*** are non-parametric and measure the strength and direction of the association between two ranked variables.

### Step 2: Preliminary Checks

Before applying Pearson's correlation, check the assumptions:

i. Normality Check --> Use the Shapiro-Wilk test to assess if the variables are normally distributed.

- Null hypothesis: the data = normally distributed

- Alternative hypothesis: the data = not normally distributed

- If the p-value is less than 0.05, the null hypothesis is rejected
```{r}
# Shapiro-Wilk test for normality
shapiro.test(mtcars$mpg)
shapiro.test(mtcars$wt)
```

<details>

<summary>*Does from data of each of the 2 variables (mpg, wt) follow a normal distribution?*:</summary>

`mpg`: The p-value is 0.1229, which is greater than 0.05. Therefore, we do not reject the null hypothesis. This suggests that the mpg variable does not significantly deviate from a normal distribution.

`wt`: The p-value is 0.09265, which is also greater than 0.05. Thus, we do not reject the null hypothesis. This indicates that the wt variable does not significantly deviate from a normal distribution.

######

ii. Visualize Normality --> Use Q-Q plots to visually inspect normality.

```{r}
library(ggpubr)
par(mfrow=c(1,2))
ggqqplot(mtcars$mpg, ylab = "MPG")
ggqqplot(mtcars$wt, ylab = "Weight")
```

<details>

<summary>*Is the covariation linear?*:</summary>

Yes, form the plot above, the relationship is linear.

######

### Step 3: Calculate Correlation

i. Pearson Correlation

```{r}
# Pearson correlation test
pearson_res <- cor.test(mtcars$mpg, mtcars$wt, method = "pearson")
pearson_res
```


ii. Spearman and Kendall Correlation

```{r}
# Spearman correlation test
spearman_res <- cor.test(mtcars$mpg, mtcars$wt, method = "spearman")
spearman_res

# Kendall correlation test
kendall_res <- cor.test(mtcars$mpg, mtcars$wt, method = "kendall")
kendall_res

```


### Step 4: Visualize the Correlation

```{r}
# Scatter plot with Pearson correlation
ggscatter(mtcars, x = "mpg", y = "wt", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Miles per Gallon", ylab = "Weight (1000 lbs)")
```


### Step 5: Interpretation 

**Correlation Coefficient:**

- `-1`: Strong negative correlation (as one variable increases, the other decreases).

- `0`: No correlation.

- `1`: Strong positive correlation (both variables increase together).

**P-Value:**

- `p-value < 0.05` indicates a statistically significant correlation.

[***Exercise:***]{style="color:red;"}

Perform a correlation analysis using the `mpg` and `qsec` variables from the `mtcars` to investigate the extent of correlation between the two variables. 

Use a method of your choosing.  

Provide and interpretation of the correlation coefficient and its p-value. 

<details>

<summary>*Example interpretation*:</summary>

The Pearson correlation coefficient is -0.8677, which points to a strong negative linear relationship between the variables. 

The p-value is significantly low (p < 0.001), indicating that the correlation is statistically significant. 

The 95% confidence interval suggests that the true correlation lies between -0.9338 and -0.7441.

### Compute correlation matrix in R

The R function cor() can be used to compute a correlation matrix.

```{r}
# We start by loading the mtcars dataset and selecting a subset of columns for our analysis.
data("mtcars")
my_data <- mtcars[, c(1, 3, 4, 5, 6, 7)]
# Display first few rows
head(my_data)

```

#### We then compute the correlation matrix:

```{r}
rescm <- cor(my_data)
# Round the results to 2 decimal places for easier interpretation
round(rescm, 2)
```

*Interpretation:*
- Values close to 1 or -1 indicate strong positive or negative correlations, respectively.

- Values close to 0 suggest little to no linear relationship.

#### Visualising the Correlation Matrix:

```{r}
library(corrplot)
corrplot(rescm,tl.col = "black", addCoef.col = "black")
```



